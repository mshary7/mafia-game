<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<link rel="icon" type="image/png" href="mafia.png" />
<meta name="description" content="🔥 لعبة مافيا شيّقة تكشف الكاذب وتختبر ذكاءك... العب مع أصدقائك واكتشف من المجرم!" />
<meta property="og:title" content="لعبة المافيا 🎭" />
<meta property="og:description" content="🔥 لعبة مافيا شيّقة تكشف الكاذب وتختبر ذكاءك... العب مع أصدقائك واكتشف من المجرم!" />
<meta property="og:image" content="https://USERNAME.github.io/REPO_NAME/mafia.png" />

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة المافيا العربية - الإصدار الأسطوري</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap');
        
        * {
            font-family: 'Cairo', sans-serif;
        }
        
        .timer-circle {
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 1s linear;
        }
        
        .fade-in {
            animation: fadeIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.6s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .role-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: perspective(1000px) rotateY(0deg);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .role-card:hover {
            transform: perspective(1000px) rotateY(5deg) scale(1.02);
            box-shadow: 0 25px 50px rgba(0,0,0,0.4);
        }
        
        .role-card.flipped {
            transform: perspective(1000px) rotateY(5deg) scale(1.05);
            box-shadow: 0 30px 60px rgba(0,0,0,0.5);
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
        }
        
        .glow {
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            to { box-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 215, 0, 0.6); }
        }
        
        .eliminated {
            opacity: 0.4;
            text-decoration: line-through;
            filter: grayscale(100%);
            transition: all 0.3s ease;
        }
        
        .night-bg {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 25%, #16213e 50%, #0f3460 100%);
            position: relative;
            overflow: hidden;
        }
        
        .night-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="1" fill="white" opacity="0.8"/><circle cx="80" cy="30" r="0.5" fill="white" opacity="0.6"/><circle cx="40" cy="60" r="0.8" fill="white" opacity="0.7"/><circle cx="90" cy="80" r="0.6" fill="white" opacity="0.5"/><circle cx="10" cy="90" r="0.4" fill="white" opacity="0.8"/></svg>') repeat;
            animation: twinkle 4s ease-in-out infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 0.3; }
        }
        
        .day-bg {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 25%, #fd79a8 50%, #fdcb6e 100%);
            position: relative;
        }
        
        .day-bg::before {
            content: '☀️';
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2rem;
            animation: rotate 10s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .selected-action {
            border-color: #fbbf24 !important;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.3), rgba(245, 158, 11, 0.2)) !important;
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
        }
        
        .selected-vote {
            border-color: #ef4444 !important;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(220, 38, 38, 0.2)) !important;
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        }
        
        .selected-skip {
            border-color: #6b7280 !important;
            background: linear-gradient(135deg, rgba(107, 114, 128, 0.3), rgba(75, 85, 99, 0.2)) !important;
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(107, 114, 128, 0.4);
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .button-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .button-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .card-3d {
            transform-style: preserve-3d;
            transition: transform 0.3s ease;
        }
        
        .card-3d:hover {
            transform: rotateX(5deg) rotateY(5deg);
        }
        
        /* تحسينات للجوال */
        @media (max-width: 768px) {
            .role-card {
                transform: none !important;
            }
            
            .role-card:hover {
                transform: scale(1.02) !important;
            }
            
            .card-3d:hover {
                transform: none;
            }
            
            .floating {
                animation: none;
            }
        }
        
        /* تحسينات للنصوص */
        .text-shadow {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .role-description {
            line-height: 1.6;
            font-size: 0.95rem;
        }
        
        /* تحسينات للأزرار */
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
        }
        
        /* تحسينات للإحصائيات */
        .stat-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.1) 100%);
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="min-h-screen transition-all duration-500 bg-gradient-to-br from-gray-900 via-purple-900 to-violet-900 relative overflow-x-hidden">
    
    <!-- خلفية متحركة -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute -top-40 -right-40 w-80 h-80 bg-purple-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-pulse"></div>
        <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-yellow-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-pulse" style="animation-delay: 2s;"></div>
        <div class="absolute top-40 left-40 w-80 h-80 bg-pink-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-pulse" style="animation-delay: 4s;"></div>
    </div>
    
    <!-- شاشة البداية -->
    <div id="startScreen" class="container mx-auto px-4 py-8 fade-in relative z-10">
        <div class="text-center mb-8">
            <h1 class="text-4xl md:text-7xl font-black mb-6 text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 floating text-shadow">
                🕵️‍♂️ لعبة المافيا العربية
            </h1>
            <div class="text-xl md:text-2xl text-gray-300 mb-4 gradient-text font-bold">الإصدار الأسطوري - للحكم والجماعة</div>
            <div class="text-sm md:text-base text-gray-400">تجربة لعب متكاملة ومتوافقة مع جميع الأجهزة</div>
        </div>
        
        <div class="max-w-4xl mx-auto glass-effect rounded-3xl p-6 md:p-8 shadow-2xl card-3d">
            <!-- إضافة اللاعبين -->
            <div class="mb-8">
                <h3 class="text-2xl md:text-3xl font-bold mb-6 text-center text-yellow-400 text-shadow">🧑‍🤝‍🧑 إضافة اللاعبين</h3>
                <div class="flex flex-col sm:flex-row gap-3 mb-6">
                    <input type="text" id="playerNameInput" placeholder="اسم اللاعب" 
                           class="flex-1 px-4 py-3 md:py-4 rounded-xl bg-white/20 border border-white/30 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition-all text-lg">
                    <button onclick="addPlayer()" class="px-6 py-3 md:py-4 btn-success rounded-xl font-bold transition-all transform hover:scale-105 button-hover text-lg">
                        ➕ إضافة
                    </button>
                </div>
                <div id="playersList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 mb-6"></div>
                <div class="text-center">
                    <p class="text-sm md:text-base text-gray-300 bg-white/10 rounded-lg p-3 inline-block">
                        <span class="font-bold text-green-400">الحد الأدنى:</span> 4 لاعبين | 
                        <span class="font-bold text-red-400">الحد الأقصى:</span> 15 لاعب
                    </p>
                </div>
            </div>
            
            <!-- إعدادات اللعبة -->
            <div class="mb-8">
                <h3 class="text-xl md:text-2xl font-bold mb-6 text-center text-blue-400 text-shadow">⚙️ إعدادات اللعبة</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="glass-effect rounded-xl p-4">
                        <label class="block text-sm md:text-base font-bold mb-3 text-yellow-300">🎯 عدد الجولات</label>
                        <select id="roundsCount" class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white focus:ring-2 focus:ring-blue-400 transition-all">
                            <option value="3">3 جولات (سريع)</option>
                            <option value="5" selected>5 جولات (متوسط)</option>
                            <option value="7">7 جولات (طويل)</option>
                            <option value="10">10 جولات (ماراثون)</option>
                        </select>
                    </div>
                    <div class="glass-effect rounded-xl p-4">
                        <label class="block text-sm md:text-base font-bold mb-3 text-yellow-300">⏰ وقت النقاش</label>
                        <select id="discussionTime" class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white focus:ring-2 focus:ring-blue-400 transition-all">
                            <option value="60">دقيقة واحدة</option>
                            <option value="120" selected>دقيقتان</option>
                            <option value="180">3 دقائق</option>
                            <option value="300">5 دقائق</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- الأدوار الإضافية -->
            <div class="mb-8">
                <h3 class="text-xl md:text-2xl font-bold mb-6 text-center text-purple-400 text-shadow">🎭 الأدوار الإضافية</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3" id="rolesConfig">
                    <label class="flex items-center space-x-3 space-x-reverse glass-effect p-4 rounded-xl cursor-pointer hover:bg-white/20 transition-all transform hover:scale-105 card-3d">
                        <input type="checkbox" class="form-checkbox text-yellow-400 w-5 h-5" data-role="detective">
                        <div class="flex-1">
                            <div class="font-bold text-blue-300">👮‍♂️ المحقق</div>
                            <div class="text-xs text-gray-400 role-description">يحقق في هوية لاعب كل ليلة ويعرف إذا كان مافيا أم لا</div>
                        </div>
                    </label>
                    <label class="flex items-center space-x-3 space-x-reverse glass-effect p-4 rounded-xl cursor-pointer hover:bg-white/20 transition-all transform hover:scale-105 card-3d">
                        <input type="checkbox" class="form-checkbox text-yellow-400 w-5 h-5" data-role="doctor">
                        <div class="flex-1">
                            <div class="font-bold text-green-300">🩺 الطبيب</div>
                            <div class="text-xs text-gray-400 role-description">ينقذ شخصاً من الموت كل ليلة (يمكنه إنقاذ نفسه)</div>
                        </div>
                    </label>
                    <label class="flex items-center space-x-3 space-x-reverse glass-effect p-4 rounded-xl cursor-pointer hover:bg-white/20 transition-all transform hover:scale-105 card-3d">
                        <input type="checkbox" class="form-checkbox text-yellow-400 w-5 h-5" data-role="sniper">
                        <div class="flex-1">
                            <div class="font-bold text-red-300">🔫 القناص</div>
                            <div class="text-xs text-gray-400 role-description">إذا تم التصويت عليه يقتل لاعباً آخر قبل موته</div>
                        </div>
                    </label>
                    <label class="flex items-center space-x-3 space-x-reverse glass-effect p-4 rounded-xl cursor-pointer hover:bg-white/20 transition-all transform hover:scale-105 card-3d">
                        <input type="checkbox" class="form-checkbox text-yellow-400 w-5 h-5" data-role="oracle">
                        <div class="flex-1">
                            <div class="font-bold text-purple-300">🔮 العراف</div>
                            <div class="text-xs text-gray-400 role-description">يعرف الدور الحقيقي والكامل للاعب كل ليلة</div>
                        </div>
                    </label>
                    <label class="flex items-center space-x-3 space-x-reverse glass-effect p-4 rounded-xl cursor-pointer hover:bg-white/20 transition-all transform hover:scale-105 card-3d">
                        <input type="checkbox" class="form-checkbox text-yellow-400 w-5 h-5" data-role="mute">
                        <div class="flex-1">
                            <div class="font-bold text-gray-300">🤐 الأخرس</div>
                            <div class="text-xs text-gray-400 role-description">ممنوع من الكلام أثناء النقاش - إذا تكلم يخرج فوراً</div>
                        </div>
                    </label>
                    <label class="flex items-center space-x-3 space-x-reverse glass-effect p-4 rounded-xl cursor-pointer hover:bg-white/20 transition-all transform hover:scale-105 card-3d">
                        <input type="checkbox" class="form-checkbox text-yellow-400 w-5 h-5" data-role="bomber">
                        <div class="flex-1">
                            <div class="font-bold text-orange-300">💣 المنتحر</div>
                            <div class="text-xs text-gray-400 role-description">هدفه أن يتم التصويت عليه ليفوز وحده ضد الجميع</div>
                        </div>
                    </label>
                    <label class="flex items-center space-x-3 space-x-reverse glass-effect p-4 rounded-xl cursor-pointer hover:bg-white/20 transition-all transform hover:scale-105 card-3d">
                        <input type="checkbox" class="form-checkbox text-yellow-400 w-5 h-5" data-role="zombie">
                        <div class="flex-1">
                            <div class="font-bold text-green-300">🧟‍♂️ الزومبي</div>
                            <div class="text-xs text-gray-400 role-description">إذا مات يعود للحياة مرة واحدة فقط في اللعبة</div>
                        </div>
                    </label>
                    <label class="flex items-center space-x-3 space-x-reverse glass-effect p-4 rounded-xl cursor-pointer hover:bg-white/20 transition-all transform hover:scale-105 card-3d">
                        <input type="checkbox" class="form-checkbox text-yellow-400 w-5 h-5" data-role="disguise">
                        <div class="flex-1">
                            <div class="font-bold text-pink-300">🎭 المتنكر</div>
                            <div class="text-xs text-gray-400 role-description">يمكنه تغيير هويته مرة واحدة أثناء اللعبة</div>
                        </div>
                    </label>
                    <label class="flex items-center space-x-3 space-x-reverse glass-effect p-4 rounded-xl cursor-pointer hover:bg-white/20 transition-all transform hover:scale-105 card-3d">
                        <input type="checkbox" class="form-checkbox text-yellow-400 w-5 h-5" data-role="survivor">
                        <div class="flex-1">
                            <div class="font-bold text-yellow-300">🧑‍🎤 الناجي</div>
                            <div class="text-xs text-gray-400 role-description">هدفه البقاء حياً حتى نهاية اللعبة ليفوز منفرداً</div>
                        </div>
                    </label>
                </div>
            </div>
            
            <button onclick="startGame()" id="startGameBtn" disabled 
                    class="w-full py-4 md:py-5 bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-500 hover:to-orange-600 rounded-xl font-bold text-xl md:text-2xl text-black transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none glow button-hover">
                🚀 بدء اللعبة الأسطورية
            </button>
        </div>
        
        <!-- قسم شرح اللعبة للمبتدئين -->
        <div class="max-w-6xl mx-auto mt-12 glass-effect rounded-3xl p-6 md:p-8 shadow-2xl card-3d">
            <h2 class="text-2xl md:text-4xl font-bold mb-8 text-center text-cyan-400 text-shadow">🧩 شرح لعبة المافيا العربية للمبتدئين</h2>
            
            <!-- الشرح الأساسي -->
            <div class="glass-effect rounded-xl p-4 md:p-6 mb-6">
                <div class="text-sm md:text-base text-gray-200 leading-relaxed space-y-4">
                    <p class="font-bold text-yellow-300 text-lg">لعبة المافيا هي لعبة جماعية تجمع بين الذكاء والحوار، تنقسم المجموعة إلى فريقين رئيسيين:</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 my-6">
                        <div class="bg-red-500/20 border border-red-400/50 rounded-lg p-4">
                            <h4 class="font-bold text-red-400 mb-2 text-lg">🕵️‍♂️ المافيا</h4>
                            <p class="text-sm">هدفهم القضاء على المدنيين دون أن يتم اكتشافهم</p>
                        </div>
                        <div class="bg-green-500/20 border border-green-400/50 rounded-lg p-4">
                            <h4 class="font-bold text-green-400 mb-2 text-lg">🧑‍🤝‍🧑 المدنيون</h4>
                            <p class="text-sm">هدفهم كشف المافيا والتصويت عليهم لإخراجهم</p>
                        </div>
                    </div>
                    
                    <div class="bg-white/10 rounded-lg p-4">
                        <h4 class="font-bold text-yellow-300 mb-3 text-lg">📋 طريقة اللعب باختصار:</h4>
                        <ol class="text-sm space-y-2 list-decimal list-inside">
                            <li>يتم إدخال أسماء اللاعبين وتوزيع الأدوار سرًا (كل لاعب يرى دوره فقط)</li>
                            <li class="font-bold text-blue-300">اللعبة تدور في جولات ليل ونهار:</li>
                        </ol>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <div class="bg-blue-900/30 rounded-lg p-3">
                                <h5 class="font-bold text-blue-300 mb-2">🌙 في الليل:</h5>
                                <ul class="text-xs space-y-1">
                                    <li>• المافيا يقررون من يقتلون</li>
                                    <li>• الطبيب ينقذ شخصًا</li>
                                    <li>• المحقق والعراف يحققون في هوية أحد اللاعبين</li>
                                </ul>
                            </div>
                            <div class="bg-yellow-900/30 rounded-lg p-3">
                                <h5 class="font-bold text-yellow-300 mb-2">☀️ في النهار:</h5>
                                <ul class="text-xs space-y-1">
                                    <li>• جميع اللاعبين يناقشون من المافيا</li>
                                    <li>• ثم يصوت كل لاعب لطرد أحد المشكوك بهم</li>
                                    <li>• من يحصل على أعلى الأصوات يخرج</li>
                                </ul>
                            </div>
                        </div>
                        
                        <p class="text-sm mt-4 text-center font-bold text-green-300">تستمر الجولات حتى يفوز فريق أو يحقق أحد الأدوار هدفه الخاص</p>
                    </div>
                </div>
            </div>
            
            <!-- شرح وضع الحكم -->
            <div class="glass-effect rounded-xl p-4 md:p-6 mb-6">
                <h4 class="font-bold text-orange-400 mb-4 text-lg text-center">👨‍⚖️ شرح وضع الحكم</h4>
                <div class="text-sm md:text-base text-gray-200 leading-relaxed space-y-3">
                    <p>• <strong class="text-yellow-300">الحكم هو شخص لا يشارك في اللعبة كلاعب</strong>، بل يدير اللعبة عبر التطبيق</p>
                    <p>• يعرف الحكم أدوار جميع اللاعبين ويتابع قرارات كل دور خاص أثناء الليل</p>
                    <p>• يدخل قرارات المافيا، الطبيب، المحقق، العراف... في التطبيق ويعلن النتائج دون كشف هويات الأدوار</p>
                    <p>• <strong class="text-red-300">يمنع الحكم كشف أي هوية أثناء اللعب</strong>، ويعلن النتائج بوضوح بعد كل جولة</p>
                    <p>• الحكم يراقب القوانين (الأخرس، القناص، المنتحر...) ويطبقها بعدل وسرية</p>
                </div>
            </div>
            
            <!-- شرح الأدوار الخاصة -->
            <div class="glass-effect rounded-xl p-4 md:p-6 mb-6">
                <h4 class="font-bold text-purple-400 mb-4 text-lg text-center">🗂️ شرح الأدوار الخاصة</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                    <div class="bg-blue-500/20 border border-blue-400/50 rounded-lg p-3">
                        <h5 class="font-bold text-blue-300 mb-2">👮‍♂️ المحقق</h5>
                        <p class="text-xs text-gray-300">يحقق في هوية لاعب كل ليلة ويعرف إذا كان مافيا أم لا</p>
                    </div>
                    <div class="bg-green-500/20 border border-green-400/50 rounded-lg p-3">
                        <h5 class="font-bold text-green-300 mb-2">🩺 الطبيب</h5>
                        <p class="text-xs text-gray-300">ينقذ شخصًا من الموت كل ليلة (ويمكنه إنقاذ نفسه)</p>
                    </div>
                    <div class="bg-red-500/20 border border-red-400/50 rounded-lg p-3">
                        <h5 class="font-bold text-red-300 mb-2">🔫 القناص</h5>
                        <p class="text-xs text-gray-300">إذا تم التصويت عليه للخروج، يختار لاعبًا آخر ليخرجه معه فورًا</p>
                    </div>
                    <div class="bg-purple-500/20 border border-purple-400/50 rounded-lg p-3">
                        <h5 class="font-bold text-purple-300 mb-2">🔮 العراف</h5>
                        <p class="text-xs text-gray-300">يعرف الدور الحقيقي والكامل لأي لاعب يختاره كل ليلة</p>
                    </div>
                    <div class="bg-gray-500/20 border border-gray-400/50 rounded-lg p-3">
                        <h5 class="font-bold text-gray-300 mb-2">🤐 الأخرس</h5>
                        <p class="text-xs text-gray-300">ممنوع من الكلام أثناء النقاش، وإذا تكلم يخرج فورًا</p>
                    </div>
                    <div class="bg-orange-500/20 border border-orange-400/50 rounded-lg p-3">
                        <h5 class="font-bold text-orange-300 mb-2">💣 المنتحر</h5>
                        <p class="text-xs text-gray-300">هدفه أن يتم التصويت عليه ليخرج، ويفوز وحده حتى لو خسر فريقه</p>
                    </div>
                    <div class="bg-green-500/20 border border-green-400/50 rounded-lg p-3">
                        <h5 class="font-bold text-green-300 mb-2">🧟‍♂️ الزومبي</h5>
                        <p class="text-xs text-gray-300">إذا مات يعود للحياة مرة واحدة فقط في اللعبة</p>
                    </div>
                    <div class="bg-pink-500/20 border border-pink-400/50 rounded-lg p-3">
                        <h5 class="font-bold text-pink-300 mb-2">🎭 المتنكر</h5>
                        <p class="text-xs text-gray-300">يمكنه تغيير هويته إلى دور آخر مرة واحدة فقط أثناء اللعبة</p>
                    </div>
                    <div class="bg-yellow-500/20 border border-yellow-400/50 rounded-lg p-3">
                        <h5 class="font-bold text-yellow-300 mb-2">🧑‍🎤 الناجي</h5>
                        <p class="text-xs text-gray-300">هدفه البقاء حيًا حتى نهاية اللعبة ليفوز منفردًا</p>
                    </div>
                </div>
            </div>
            
            <!-- نصائح نهائية -->
            <div class="bg-gradient-to-r from-green-600/20 to-blue-600/20 border border-green-400/50 rounded-xl p-4 text-center">
                <h4 class="font-bold text-green-300 mb-3 text-lg">🎯 نصائح للاستمتاع باللعبة</h4>
                <div class="text-sm text-gray-200 space-y-2">
                    <p><strong class="text-yellow-300">استمتعوا باللعب والتحليل والنقاش!</strong></p>
                    <p>إذا لم تعرف دورك أو قوانين اللعبة، راجع هذا الشرح أو اسأل الحكم قبل بدء الجولة</p>
                    <p class="text-xs text-gray-400 italic">💡 نصيحة: اللعبة أكثر متعة مع 6-10 لاعبين</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- شاشة توزيع الأدوار -->
    <div id="roleDistributionScreen" class="hidden container mx-auto px-4 py-8 relative z-10">
        <div class="text-center mb-8">
            <h2 class="text-3xl md:text-4xl font-bold mb-4 text-yellow-400 text-shadow floating">🎭 توزيع الأدوار</h2>
            <p class="text-lg md:text-xl text-gray-300">مرر الجهاز لكل لاعب ليرى دوره سراً</p>
            <div class="mt-4 text-sm text-gray-400 bg-white/10 rounded-lg p-3 inline-block">
                ⚠️ تأكد أن اللاعبين الآخرين لا يرون الشاشة
            </div>
        </div>
        
        <div class="max-w-md mx-auto">
            <div class="glass-effect rounded-3xl p-8 text-center card-3d">
                <h3 class="text-2xl md:text-3xl font-bold mb-6 text-white" id="currentPlayerName">اللاعب الأول</h3>
                <div class="role-card bg-gradient-to-br from-purple-600 to-blue-600 rounded-2xl p-8 mb-6 cursor-pointer shadow-2xl" onclick="revealRole()">
                    <div id="roleContent" class="text-6xl md:text-8xl mb-4">❓</div>
                    <p class="text-lg md:text-xl font-bold" id="roleDescription">اضغط لرؤية دورك</p>
                </div>
                <button onclick="nextPlayer()" id="nextPlayerBtn" class="w-full py-3 md:py-4 btn-success rounded-xl font-bold text-lg transition-all transform hover:scale-105 button-hover" style="display: none;">
                    ➡️ اللاعب التالي
                </button>
            </div>
        </div>
    </div>
    
    <!-- شاشة وضع الحكم -->
    <div id="refereeScreen" class="hidden container mx-auto px-4 py-6 relative z-10">
        <!-- رأس الشاشة -->
        <div class="text-center mb-6">
            <h2 class="text-2xl md:text-4xl font-bold mb-2 text-yellow-400 text-shadow">👨‍⚖️ وضع الحكم الأسطوري</h2>
            <div class="text-lg md:text-xl">
                <span class="text-yellow-400 font-bold">الجولة <span id="refereeRound">1</span></span> - 
                <span id="refereePhase" class="font-bold text-white">الليل</span>
            </div>
        </div>
        
        <!-- دليل الحكم -->
        <div id="refereeGuide" class="max-w-6xl mx-auto mb-6 bg-gradient-to-r from-blue-600 to-purple-600 rounded-3xl p-4 md:p-6 glass-effect">
            <h3 class="text-xl md:text-2xl font-bold mb-3 text-center text-white">📋 دليل الحكم</h3>
            <div id="guideContent" class="text-sm md:text-base space-y-2"></div>
        </div>
        
        <div class="max-w-6xl mx-auto">
            <!-- معلومات اللاعبين -->
            <div class="glass-effect rounded-3xl p-4 md:p-6 mb-6">
                <h3 class="text-xl md:text-2xl font-bold mb-4 text-center text-white">👥 اللاعبين</h3>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-bold text-green-400 mb-3 text-lg">🟢 الأحياء (<span id="aliveCount">0</span>)</h4>
                        <div id="alivePlayers" class="grid grid-cols-1 sm:grid-cols-2 gap-2"></div>
                    </div>
                    <div>
                        <h4 class="font-bold text-red-400 mb-3 text-lg">💀 الموتى (<span id="deadCount">0</span>)</h4>
                        <div id="deadPlayers" class="grid grid-cols-1 sm:grid-cols-2 gap-2"></div>
                    </div>
                </div>
            </div>
            
            <!-- مرحلة الليل -->
            <div id="nightPhase" class="night-bg rounded-3xl p-4 md:p-6 mb-6 relative">
                <h3 class="text-2xl md:text-3xl font-bold mb-6 text-center text-white text-shadow">🌙 مرحلة الليل</h3>
                
                <!-- دور المافيا -->
                <div id="mafiaAction" class="mb-6 glass-effect rounded-xl p-4 md:p-6">
                    <h4 class="text-lg md:text-xl font-bold mb-3 text-red-400">🕵️‍♂️ دور المافيا</h4>
                    <p class="text-sm md:text-base text-gray-300 mb-4">اسأل لاعبي المافيا سراً: "من تريدون قتله هذه الليلة؟"</p>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 mb-4" id="mafiaTargets"></div>
                    <div id="mafiaResult" class="text-center text-yellow-300 font-bold text-lg"></div>
                </div>
                
                <!-- دور الطبيب -->
                <div id="doctorAction" class="mb-6 glass-effect rounded-xl p-4 md:p-6 hidden">
                    <h4 class="text-lg md:text-xl font-bold mb-3 text-green-400">🩺 دور الطبيب</h4>
                    <p class="text-sm md:text-base text-gray-300 mb-4">اسأل الطبيب سراً: "من تريد علاجه الليلة؟"</p>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 mb-4" id="doctorTargets"></div>
                    <div id="doctorResult" class="text-center text-yellow-300 font-bold text-lg"></div>
                </div>
                
                <!-- دور المحقق -->
                <div id="detectiveAction" class="mb-6 glass-effect rounded-xl p-4 md:p-6 hidden">
                    <h4 class="text-lg md:text-xl font-bold mb-3 text-blue-400">👮‍♂️ دور المحقق</h4>
                    <p class="text-sm md:text-base text-gray-300 mb-4">اسأل المحقق سراً: "من تريد التحقق من هويته؟"</p>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 mb-4" id="detectiveTargets"></div>
                    <div id="detectiveResult" class="mt-4 p-4 bg-blue-900/50 rounded-lg hidden">
                        <p class="font-bold text-center text-lg">🔍 النتيجة: <span id="detectiveResultText" class="text-yellow-300"></span></p>
                        <p class="text-xs md:text-sm text-center text-gray-300 mt-2">أخبر المحقق هذه النتيجة سراً</p>
                    </div>
                </div>
                
                <!-- دور العراف -->
                <div id="oracleAction" class="mb-6 glass-effect rounded-xl p-4 md:p-6 hidden">
                    <h4 class="text-lg md:text-xl font-bold mb-3 text-purple-400">🔮 دور العراف</h4>
                    <p class="text-sm md:text-base text-gray-300 mb-4">اسأل العراف سراً: "من تريد معرفة دوره الحقيقي؟"</p>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 mb-4" id="oracleTargets"></div>
                    <div id="oracleResult" class="mt-4 p-4 bg-purple-900/50 rounded-lg hidden">
                        <p class="font-bold text-center text-lg">🔮 الدور: <span id="oracleResultText" class="text-yellow-300"></span></p>
                        <p class="text-xs md:text-sm text-center text-gray-300 mt-2">أخبر العراف هذه المعلومة سراً</p>
                    </div>
                </div>
                
                <button onclick="endNight()" id="endNightBtn" class="w-full py-3 md:py-4 btn-warning rounded-xl font-bold text-lg md:text-xl transition-all transform hover:scale-105 button-hover">
                    ☀️ انتهاء الليل - بدء النهار
                </button>
            </div>
            
            <!-- مرحلة النهار -->
            <div id="dayPhase" class="hidden day-bg rounded-3xl p-4 md:p-6 mb-6 text-black relative">
                <h3 class="text-2xl md:text-3xl font-bold mb-6 text-center text-shadow">☀️ مرحلة النهار</h3>
                
                <!-- نتائج الليل -->
                <div id="nightResults" class="mb-6 glass-effect rounded-xl p-4 md:p-6">
                    <h4 class="text-lg md:text-xl font-bold mb-3">📢 أعلن للجميع:</h4>
                    <div id="nightResultsText" class="bg-white/30 rounded-lg p-4 font-bold text-center text-lg md:text-xl"></div>
                </div>
                
                <!-- مرحلة النقاش -->
                <div class="mb-6 glass-effect rounded-xl p-4 md:p-6">
                    <h4 class="text-lg md:text-xl font-bold mb-3">💬 مرحلة النقاش</h4>
                    <p class="text-sm md:text-base mb-4">اتركهم يتناقشون - راقب الأخرس إذا كان موجوداً!</p>
                    <div class="text-center mb-4">
                        <div class="text-4xl md:text-6xl font-bold mb-4 text-blue-600" id="discussionTimer">2:00</div>
                        <button onclick="startDiscussionTimer()" id="startDiscussionBtn" class="px-6 py-3 btn-primary text-white rounded-lg hover:bg-blue-700 transition-all transform hover:scale-105 button-hover">
                            🕐 بدء مؤقت النقاش
                        </button>
                    </div>
                    
                    <!-- تحذير الأخرس -->
                    <div id="muteWarning" class="mt-4 p-4 bg-red-500/30 border-2 border-red-500 rounded-lg hidden">
                        <p class="font-bold text-red-800 text-center mb-3">⚠️ تحذير: إذا تكلم الأخرس، اضغط هنا لاستبعاده فوراً</p>
                        <button onclick="eliminateMute()" class="w-full px-4 py-3 btn-danger text-white rounded-lg font-bold">
                            🤐 استبعاد الأخرس
                        </button>
                    </div>
                </div>
                
                <!-- مرحلة التصويت -->
                <div class="mb-6 glass-effect rounded-xl p-4 md:p-6">
                    <h4 class="text-lg md:text-xl font-bold mb-3">🗳️ مرحلة التصويت</h4>
                    <p class="text-sm md:text-base mb-4">اجمع أصوات اللاعبين واختر من حصل على أكثر الأصوات</p>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 mb-4" id="votingTargets"></div>
                    
                    <!-- خيار السكب -->
                    <div class="text-center mb-4">
                        <button onclick="selectSkip()" id="skipBtn" class="px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-xl font-bold transition-all border-2 border-transparent transform hover:scale-105 button-hover">
                            🤝 سِكِب (لا أحد يخرج)
                        </button>
                    </div>
                    
                    <div id="votingResult" class="text-center font-bold text-lg md:text-xl"></div>
                </div>
                
                <!-- دور القناص -->
                <div id="sniperAction" class="mb-6 bg-red-900/50 rounded-xl p-4 md:p-6 hidden">
                    <h4 class="text-lg md:text-xl font-bold mb-3 text-red-300">🔫 دور القناص</h4>
                    <p class="text-sm md:text-base mb-4 text-white">القناص خرج! اسأله سراً: "من تريد تصفيته معك؟"</p>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2" id="sniperTargets"></div>
                </div>
                
                <button onclick="endDay()" id="endDayBtn" class="w-full py-3 md:py-4 bg-purple-600 hover:bg-purple-700 text-white rounded-xl font-bold text-lg md:text-xl transition-all transform hover:scale-105 button-hover">
                    🌙 انتهاء النهار - بدء الليل
                </button>
            </div>
        </div>
    </div>

    <!-- شاشة النتائج النهائية -->
    <div id="finalResultsScreen" class="hidden container mx-auto px-4 py-8 relative z-10">
        <div class="text-center mb-8">
            <h2 class="text-3xl md:text-5xl font-bold mb-4 text-yellow-400 text-shadow floating">🏆 النتائج النهائية</h2>
        </div>
        
        <div class="max-w-6xl mx-auto">
            <!-- الفائز -->
            <div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-3xl p-6 md:p-8 text-black text-center mb-6 glow card-3d">
                <h3 class="text-2xl md:text-4xl font-bold mb-4">🎉 الفائز</h3>
                <div id="winner" class="text-xl md:text-3xl font-bold"></div>
            </div>
            
            <!-- الإنجازات -->
            <div id="achievementsSection" class="bg-gradient-to-r from-purple-600 to-blue-600 rounded-3xl p-6 mb-6 card-3d">
                <h3 class="text-2xl md:text-3xl font-bold mb-6 text-center text-white">🏅 الإنجازات والأدوار</h3>
                <div id="achievementsList" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"></div>
            </div>
            
            <!-- دليل الإعلان للحكم -->
            <div id="announcementGuide" class="bg-gradient-to-r from-green-600 to-blue-600 rounded-3xl p-6 mb-6 card-3d">
                <h3 class="text-2xl md:text-3xl font-bold mb-6 text-center text-white">📢 دليل الإعلان للحكم</h3>
                <div class="bg-white/20 rounded-xl p-4 mb-4">
                    <h4 class="font-bold text-lg mb-2 text-yellow-300">🎯 كيفية إعلان النتائج:</h4>
                    <ol class="text-sm md:text-base space-y-2 text-white">
                        <li><strong>1.</strong> أعلن الفريق الفائز بوضوح</li>
                        <li><strong>2.</strong> اكشف جميع الأدوار للاعبين</li>
                        <li><strong>3.</strong> اذكر الإنجازات الخاصة</li>
                        <li><strong>4.</strong> اسأل عن إعادة اللعب</li>
                    </ol>
                </div>
                <div id="announcementContent" class="space-y-3 text-sm md:text-base"></div>
            </div>
            
            <!-- إحصائيات اللاعبين -->
            <div class="glass-effect rounded-3xl p-6 md:p-8 mb-6 card-3d">
                <h3 class="text-2xl md:text-3xl font-bold mb-6 text-center text-white">📈 إحصائيات اللاعبين</h3>
                <div id="playerStats" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            </div>
            
            <!-- كشف الأدوار للحكم -->
            <div class="bg-gradient-to-r from-purple-600 to-pink-600 rounded-3xl p-6 mb-6 card-3d">
                <h3 class="text-2xl md:text-3xl font-bold mb-6 text-center text-white">🎭 كشف الأدوار (للحكم)</h3>
                <div class="bg-white/20 rounded-xl p-4 mb-4">
                    <p class="text-center text-sm md:text-base mb-2 text-yellow-300 font-bold">📢 اقرأ هذه المعلومات بصوت عالٍ للاعبين</p>
                    <p class="text-xs md:text-sm text-center text-gray-300 italic">"الآن سأكشف لكم أدوار جميع اللاعبين في هذه الجولة..."</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="roleRevealList"></div>
            </div>
            
            <div class="flex flex-col sm:flex-row gap-4">
                <button onclick="playAgain()" class="flex-1 py-3 md:py-4 btn-success rounded-xl font-bold text-lg md:text-xl transition-all transform hover:scale-105 button-hover">
                    🔄 إعادة اللعب
                </button>
                <button onclick="newGame()" class="flex-1 py-3 md:py-4 btn-primary text-white rounded-xl font-bold text-lg md:text-xl transition-all transform hover:scale-105 button-hover">
                    🆕 لعبة جديدة
                </button>
            </div>
        </div>
    </div>

    <script>
        // متغيرات اللعبة
        let players = [];
        let gameSettings = {
            rounds: 5,
            discussionTime: 120,
            enabledRoles: []
        };
        let currentGame = {
            round: 1,
            phase: 'night',
            currentPlayerIndex: 0,
            roles: {},
            alivePlayers: [],
            deadPlayers: [],
            playerStats: {},
            nightActions: {
                mafiaKill: null,
                doctorSave: null,
                detectiveCheck: null,
                oracleCheck: null
            },
            votingResult: null,
            specialAbilities: {
                zombieRevived: false,
                disguiseUsed: false
            },
            discussionTimerActive: false
        };

        // الأدوار المتاحة مع الأوصاف الكاملة والمحسنة
        const roles = {
            mafia: { 
                name: 'المافيا', 
                emoji: '🕵️‍♂️', 
                description: 'ينسق مع أعضاء المافيا الآخرين لقتل المدنيين كل ليلة. هدفهم السيطرة على القرية.',
                team: 'mafia',
                color: 'text-red-400'
            },
            detective: { 
                name: 'المحقق', 
                emoji: '👮‍♂️', 
                description: 'يحقق في هوية لاعب واحد كل ليلة ويعرف إذا كان من المافيا أم لا. دوره سري.',
                team: 'citizen',
                color: 'text-blue-400'
            },
            doctor: { 
                name: 'الطبيب', 
                emoji: '🩺', 
                description: 'ينقذ شخصاً واحداً من الموت كل ليلة. يمكنه إنقاذ نفسه مرة واحدة فقط.',
                team: 'citizen',
                color: 'text-green-400'
            },
            citizen: { 
                name: 'مدني', 
                emoji: '🧑‍🤝‍🧑', 
                description: 'مواطن عادي يحاول كشف المافيا والتصويت ضدهم لحماية القرية.',
                team: 'citizen',
                color: 'text-green-400'
            },
            sniper: { 
                name: 'القناص', 
                emoji: '🔫', 
                description: 'إذا تم التصويت عليه وإقصاؤه، يقتل لاعباً آخر قبل موته انتقاماً.',
                team: 'citizen',
                color: 'text-red-400'
            },
            oracle: { 
                name: 'العراف', 
                emoji: '🔮', 
                description: 'يعرف الدور الحقيقي والكامل للاعب واحد كل ليلة. معلوماته دقيقة 100%.',
                team: 'citizen',
                color: 'text-purple-400'
            },
            mute: { 
                name: 'الأخرس', 
                emoji: '🤐', 
                description: 'ممنوع من الكلام نهائياً أثناء مرحلة النقاش. إذا تكلم يتم إقصاؤه فوراً.',
                team: 'citizen',
                color: 'text-gray-400'
            },
            bomber: { 
                name: 'المنتحر', 
                emoji: '💣', 
                description: 'هدفه الوحيد أن يتم التصويت عليه ليفوز منفرداً ضد جميع اللاعبين.',
                team: 'independent',
                color: 'text-orange-400'
            },
            zombie: { 
                name: 'الزومبي', 
                emoji: '🧟‍♂️', 
                description: 'إذا مات يعود للحياة مرة واحدة فقط في اللعبة. قوة خارقة للطبيعة.',
                team: 'citizen',
                color: 'text-green-400'
            },
            disguise: { 
                name: 'المتنكر', 
                emoji: '🎭', 
                description: 'يمكنه تغيير هويته وإظهار دور مختلف للمحقق مرة واحدة أثناء اللعبة.',
                team: 'citizen',
                color: 'text-pink-400'
            },
            survivor: { 
                name: 'الناجي', 
                emoji: '🧑‍🎤', 
                description: 'هدفه الوحيد البقاء حياً حتى نهاية اللعبة ليفوز منفرداً بغض النظر عن الفائز.',
                team: 'independent',
                color: 'text-yellow-400'
            }
        };

        // إضافة لاعب
        function addPlayer() {
            const input = document.getElementById('playerNameInput');
            const name = input.value.trim();
            
            if (name && !players.includes(name) && players.length < 15) {
                players.push(name);
                updatePlayersList();
                input.value = '';
                updateStartButton();
                
                // تأثير بصري
                const list = document.getElementById('playersList');
                const newPlayer = list.lastElementChild;
                if (newPlayer) {
                    newPlayer.classList.add('slide-in');
                }
            } else if (name && players.includes(name)) {
                showNotification('هذا الاسم موجود بالفعل!', 'warning');
            } else if (players.length >= 15) {
                showNotification('الحد الأقصى 15 لاعب!', 'error');
            }
        }

        // تحديث قائمة اللاعبين
        function updatePlayersList() {
            const list = document.getElementById('playersList');
            list.innerHTML = players.map((player, index) => 
                `<div class="stat-card rounded-lg p-3 flex justify-between items-center">
                    <span class="font-bold text-white">${player}</span>
                    <button onclick="removePlayer('${player}')" class="text-red-400 hover:text-red-300 ml-2 transition-colors transform hover:scale-110">
                        ✕
                    </button>
                </div>`
            ).join('');
        }

        // حذف لاعب
        function removePlayer(name) {
            players = players.filter(p => p !== name);
            updatePlayersList();
            updateStartButton();
        }

        // تحديث زر البداية
        function updateStartButton() {
            const btn = document.getElementById('startGameBtn');
            btn.disabled = players.length < 4;
            
            if (players.length < 4) {
                btn.textContent = `🚀 بدء اللعبة (${players.length}/4 لاعبين)`;
                btn.classList.remove('glow');
            } else {
                btn.textContent = '🚀 بدء اللعبة الأسطورية';
                btn.classList.add('glow');
            }
        }

        // إظهار إشعار
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg font-bold text-white transform transition-all duration-300 ${
                type === 'error' ? 'bg-red-500' : 
                type === 'warning' ? 'bg-yellow-500' : 
                type === 'success' ? 'bg-green-500' : 'bg-blue-500'
            }`;
            notification.textContent = message;
            notification.style.transform = 'translateX(100%)';
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // بدء اللعبة
        function startGame() {
            if (players.length < 4) {
                showNotification('يجب إضافة 4 لاعبين على الأقل!', 'error');
                return;
            }

            // جمع الإعدادات
            gameSettings.rounds = parseInt(document.getElementById('roundsCount').value);
            gameSettings.discussionTime = parseInt(document.getElementById('discussionTime').value);
            gameSettings.enabledRoles = Array.from(document.querySelectorAll('#rolesConfig input:checked'))
                .map(cb => cb.dataset.role);

            // توزيع الأدوار
            distributeRoles();
            
            // بدء توزيع الأدوار
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('roleDistributionScreen').classList.remove('hidden');
            
            currentGame.currentPlayerIndex = 0;
            showCurrentPlayer();
        }

        // توزيع الأدوار
        function distributeRoles() {
            const totalPlayers = players.length;
            const mafiaCount = Math.max(1, Math.floor(totalPlayers / 3));
            
            let rolesList = [];
            
            // إضافة المافيا
            for (let i = 0; i < mafiaCount; i++) {
                rolesList.push('mafia');
            }
            
            // إضافة الأدوار الإضافية
            gameSettings.enabledRoles.forEach(role => {
                if (rolesList.length < totalPlayers) {
                    rolesList.push(role);
                }
            });
            
            // ملء الباقي بالمدنيين
            while (rolesList.length < totalPlayers) {
                rolesList.push('citizen');
            }
            
            // خلط الأدوار
            rolesList = rolesList.sort(() => Math.random() - 0.5);
            
            // توزيع الأدوار على اللاعبين
            players.forEach((player, index) => {
                currentGame.roles[player] = rolesList[index];
                currentGame.playerStats[player] = {
                    votes: 0,
                    eliminated: 0,
                    survived: 0,
                    nightKills: 0,
                    role: rolesList[index]
                };
            });
            
            // تحديد اللاعبين الأحياء
            currentGame.alivePlayers = [...players];
            currentGame.deadPlayers = [];
        }

        // إظهار اللاعب الحالي
        function showCurrentPlayer() {
            if (currentGame.currentPlayerIndex < players.length) {
                const playerName = players[currentGame.currentPlayerIndex];
                document.getElementById('currentPlayerName').textContent = playerName;
                document.getElementById('roleContent').textContent = '❓';
                document.getElementById('roleDescription').textContent = 'اضغط لرؤية دورك السري';
                document.getElementById('nextPlayerBtn').style.display = 'none';
                
                // إعادة تعيين البطاقة
                const roleCard = document.querySelector('.role-card');
                roleCard.classList.remove('flipped');
            }
        }

        // كشف الدور
        function revealRole() {
            if (currentGame.currentPlayerIndex >= players.length) return;
            
            const playerName = players[currentGame.currentPlayerIndex];
            const playerRole = currentGame.roles[playerName];
            const role = roles[playerRole];
            
            if (!role) return;
            
            document.getElementById('roleContent').textContent = role.emoji;
            document.getElementById('roleDescription').innerHTML = 
                `<div class="text-2xl font-bold mb-2 ${role.color}">${role.name}</div>
                 <div class="text-sm text-gray-300 leading-relaxed">${role.description}</div>
                 <div class="text-xs text-gray-400 mt-2">الفريق: ${
                     role.team === 'mafia' ? '🔴 المافيا' : 
                     role.team === 'citizen' ? '🟢 المدنيون' : 
                     '🟡 مستقل'
                 }</div>`;
            
            document.getElementById('nextPlayerBtn').style.display = 'block';
            
            // تأثير بصري بدون انقلاب
            const roleCard = document.querySelector('.role-card');
            roleCard.classList.add('flipped');
        }

        // اللاعب التالي
        function nextPlayer() {
            currentGame.currentPlayerIndex++;
            
            if (currentGame.currentPlayerIndex >= players.length) {
                startRefereeMode();
            } else {
                showCurrentPlayer();
            }
        }

        // بدء وضع الحكم
        function startRefereeMode() {
            document.getElementById('roleDistributionScreen').classList.add('hidden');
            document.getElementById('refereeScreen').classList.remove('hidden');
            
            updateRefereeDisplay();
            startNightPhase();
        }

        // تحديث عرض وضع الحكم
        function updateRefereeDisplay() {
            document.getElementById('refereeRound').textContent = currentGame.round;
            document.getElementById('refereePhase').textContent = currentGame.phase === 'night' ? 'الليل' : 'النهار';
            
            // عرض اللاعبين الأحياء
            const aliveContainer = document.getElementById('alivePlayers');
            aliveContainer.innerHTML = currentGame.alivePlayers.map(player => {
                const role = roles[currentGame.roles[player]];
                return `<div class="stat-card rounded-lg p-3 text-center border-2 border-green-400/50">
                    <div class="font-bold text-sm md:text-base text-white">${player}</div>
                    <div class="text-xs text-gray-300">${role.emoji} ${role.name}</div>
                </div>`;
            }).join('');
            
            // عرض اللاعبين الموتى
            const deadContainer = document.getElementById('deadPlayers');
            deadContainer.innerHTML = currentGame.deadPlayers.map(player => {
                const role = roles[currentGame.roles[player]];
                return `<div class="stat-card rounded-lg p-3 text-center border-2 border-red-400/50 eliminated">
                    <div class="font-bold text-sm md:text-base text-white">${player}</div>
                    <div class="text-xs text-gray-300">${role.emoji} ${role.name}</div>
                </div>`;
            }).join('');
            
            // تحديث العدادات
            document.getElementById('aliveCount').textContent = currentGame.alivePlayers.length;
            document.getElementById('deadCount').textContent = currentGame.deadPlayers.length;
            
            // تحديث دليل الحكم
            updateRefereeGuide();
        }

        // تحديث دليل الحكم
        function updateRefereeGuide() {
            const guideContent = document.getElementById('guideContent');
            
            if (currentGame.phase === 'night') {
                guideContent.innerHTML = `
                    <div class="bg-white/20 rounded-lg p-3 mb-2">
                        <p class="font-bold text-yellow-300 mb-2">🌙 مرحلة الليل - إرشادات الحكم:</p>
                        <ul class="text-sm space-y-1">
                            <li>• اسأل المافيا سراً: "من تريدون قتله هذه الليلة؟"</li>
                            <li>• اسأل الطبيب سراً: "من تريد علاجه؟" (إن وُجد)</li>
                            <li>• اسأل المحقق سراً: "من تريد التحقق منه؟" (إن وُجد)</li>
                            <li>• اسأل العراف سراً: "من تريد معرفة دوره؟" (إن وُجد)</li>
                        </ul>
                        <p class="text-xs text-red-300 mt-2 font-bold">⚠️ تذكر: لا تكشف هوية أي لاعب للآخرين!</p>
                    </div>
                `;
            } else {
                guideContent.innerHTML = `
                    <div class="bg-white/20 rounded-lg p-3 mb-2">
                        <p class="font-bold text-yellow-300 mb-2">☀️ مرحلة النهار - إرشادات الحكم:</p>
                        <ul class="text-sm space-y-1">
                            <li>• أعلن نتائج الليل للجميع بوضوح</li>
                            <li>• ابدأ مؤقت النقاش وراقب الأخرس (إن وُجد)</li>
                            <li>• اجمع أصوات اللاعبين لمن يريدون إقصاءه</li>
                            <li>• إذا خرج القناص، اسأله عمن يريد قتله</li>
                        </ul>
                        <p class="text-xs text-red-300 mt-2 font-bold">⚠️ تذكر: إذا تكلم الأخرس، استبعده فوراً!</p>
                    </div>
                `;
            }
        }

        // بدء مرحلة الليل
        function startNightPhase() {
            currentGame.phase = 'night';
            currentGame.nightActions = { 
                mafiaKill: null, 
                doctorSave: null, 
                detectiveCheck: null,
                oracleCheck: null 
            };
            
            document.getElementById('nightPhase').classList.remove('hidden');
            document.getElementById('dayPhase').classList.add('hidden');
            
            // إخفاء جميع الأدوار أولاً
            document.getElementById('doctorAction').classList.add('hidden');
            document.getElementById('detectiveAction').classList.add('hidden');
            document.getElementById('oracleAction').classList.add('hidden');
            document.getElementById('muteWarning').classList.add('hidden');
            
            // إنشاء أهداف المافيا
            createActionTargets('mafiaTargets', 'mafiaKill');
            
            // إظهار الأدوار الإضافية
            if (gameSettings.enabledRoles.includes('doctor') && hasAliveRole('doctor')) {
                document.getElementById('doctorAction').classList.remove('hidden');
                createActionTargets('doctorTargets', 'doctorSave');
            }
            
            if (gameSettings.enabledRoles.includes('detective') && hasAliveRole('detective')) {
                document.getElementById('detectiveAction').classList.remove('hidden');
                createActionTargets('detectiveTargets', 'detectiveCheck');
            }
            
            if (gameSettings.enabledRoles.includes('oracle') && hasAliveRole('oracle')) {
                document.getElementById('oracleAction').classList.remove('hidden');
                createActionTargets('oracleTargets', 'oracleCheck');
            }
            
            // إظهار تحذير الأخرس إذا كان حياً
            if (gameSettings.enabledRoles.includes('mute') && hasAliveRole('mute')) {
                document.getElementById('muteWarning').classList.remove('hidden');
            }
            
            // إعادة تعيين النتائج
            document.getElementById('mafiaResult').textContent = '';
            document.getElementById('doctorResult').textContent = '';
            document.getElementById('detectiveResult').classList.add('hidden');
            document.getElementById('oracleResult').classList.add('hidden');
            
            updateRefereeDisplay();
        }

        // التحقق من وجود دور حي
        function hasAliveRole(role) {
            return currentGame.alivePlayers.some(player => currentGame.roles[player] === role);
        }

        // إنشاء أهداف الأدوار
        function createActionTargets(containerId, actionType) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = currentGame.alivePlayers.map(player => 
                `<button onclick="selectAction('${actionType}', '${player}')" 
                         class="action-target stat-card rounded-lg p-2 md:p-3 transition-all border-2 border-transparent text-sm md:text-base font-bold hover:scale-105" 
                         data-action="${actionType}" data-target="${player}">
                    ${player}
                </button>`
            ).join('');
        }

        // اختيار إجراء
        function selectAction(actionType, target) {
            if (!currentGame.alivePlayers.includes(target)) return;
            
            currentGame.nightActions[actionType] = target;
            
            // تحديث مظهر الأزرار
            document.querySelectorAll(`[data-action="${actionType}"]`).forEach(btn => {
                btn.classList.remove('selected-action');
            });
            
            const selectedBtn = document.querySelector(`[data-action="${actionType}"][data-target="${target}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('selected-action');
            }
            
            // إظهار النتائج
            if (actionType === 'mafiaKill') {
                document.getElementById('mafiaResult').textContent = `المافيا اختارت: ${target} 🎯`;
            } else if (actionType === 'doctorSave') {
                document.getElementById('doctorResult').textContent = `الطبيب اختار: ${target} 🛡️`;
            } else if (actionType === 'detectiveCheck') {
                const targetRole = currentGame.roles[target];
                const isMafia = targetRole === 'mafia';
                document.getElementById('detectiveResultText').textContent = 
                    isMafia ? `${target} هو مافيا! 🚨` : `${target} ليس مافيا ✅`;
                document.getElementById('detectiveResult').classList.remove('hidden');
            } else if (actionType === 'oracleCheck') {
                const targetRole = currentGame.roles[target];
                const role = roles[targetRole];
                document.getElementById('oracleResultText').textContent = 
                    `${target} هو ${role.name} ${role.emoji}`;
                document.getElementById('oracleResult').classList.remove('hidden');
            }
        }

        // انتهاء الليل
        function endNight() {
            const mafiaKill = currentGame.nightActions.mafiaKill;
            const doctorSave = currentGame.nightActions.doctorSave;
            
            let resultText = '';
            let killedPlayer = null;
            
            if (!mafiaKill) {
                resultText = '🌙 المافيا لم تختر أحداً - ليلة هادئة وآمنة 😴';
            } else if (mafiaKill === doctorSave) {
                resultText = `🩺 المافيا حاولت قتل ${mafiaKill} لكن الطبيب أنقذه في اللحظة الأخيرة! 🛡️`;
            } else {
                resultText = `💀 ${mafiaKill} تم قتله بواسطة المافيا أثناء الليل`;
                killedPlayer = mafiaKill;
                eliminatePlayer(mafiaKill, 'night');
            }
            
            document.getElementById('nightResultsText').textContent = resultText;
            
            // التحقق من انتهاء اللعبة
            if (checkGameEnd()) {
                showFinalResults();
                return;
            }
            
            startDayPhase();
        }

        // بدء مرحلة النهار
        function startDayPhase() {
            currentGame.phase = 'day';
            currentGame.votingResult = null;
            
            document.getElementById('nightPhase').classList.add('hidden');
            document.getElementById('dayPhase').classList.remove('hidden');
            
            // إعادة تعيين مؤقت النقاش
            const minutes = Math.floor(gameSettings.discussionTime / 60);
            const seconds = gameSettings.discussionTime % 60;
            document.getElementById('discussionTimer').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('startDiscussionBtn').disabled = false;
            document.getElementById('startDiscussionBtn').textContent = '🕐 بدء مؤقت النقاش';
            currentGame.discussionTimerActive = false;
            
            // إنشاء أهداف التصويت
            createVotingTargets();
            
            // إخفاء دور القناص
            document.getElementById('sniperAction').classList.add('hidden');
            
            // إعادة تعيين نتيجة التصويت
            document.getElementById('votingResult').textContent = '';
            
            updateRefereeDisplay();
        }

        // إنشاء أهداف التصويت
        function createVotingTargets() {
            const container = document.getElementById('votingTargets');
            if (!container) return;
            
            container.innerHTML = currentGame.alivePlayers.map(player => 
                `<button onclick="selectVotingTarget('${player}')" 
                         class="voting-target stat-card rounded-lg p-2 md:p-3 transition-all border-2 border-transparent text-sm md:text-base font-bold hover:scale-105">
                    ${player}
                </button>`
            ).join('');
        }

        // اختيار هدف التصويت
        function selectVotingTarget(player) {
            if (!currentGame.alivePlayers.includes(player)) return;
            
            // إزالة التحديد السابق
            document.querySelectorAll('.voting-target').forEach(btn => {
                btn.classList.remove('selected-vote');
            });
            document.getElementById('skipBtn').classList.remove('selected-skip');
            
            // تحديد الهدف الجديد
            const selectedBtn = document.querySelector(`[onclick="selectVotingTarget('${player}')"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('selected-vote');
            }
            
            currentGame.votingResult = player;
            document.getElementById('votingResult').textContent = `🗳️ سيتم إقصاء: ${player}`;
        }

        // اختيار السكب
        function selectSkip() {
            // إزالة التحديد السابق
            document.querySelectorAll('.voting-target').forEach(btn => {
                btn.classList.remove('selected-vote');
            });
            
            // تحديد السكب
            document.getElementById('skipBtn').classList.add('selected-skip');
            
            currentGame.votingResult = 'skip';
            document.getElementById('votingResult').textContent = '🤝 سِكِب - لا أحد سيخرج هذه الجولة';
        }

        // إقصاء لاعب
        function eliminatePlayer(player, reason = 'vote') {
            if (currentGame.alivePlayers.includes(player)) {
                currentGame.alivePlayers = currentGame.alivePlayers.filter(p => p !== player);
                currentGame.deadPlayers.push(player);
                currentGame.playerStats[player].eliminated++;
                
                if (reason === 'night') {
                    currentGame.playerStats[player].nightKills++;
                }
            }
        }

        // استبعاد الأخرس
        function eliminateMute() {
            const mutePlayer = currentGame.alivePlayers.find(p => currentGame.roles[p] === 'mute');
            if (mutePlayer) {
                eliminatePlayer(mutePlayer, 'rule');
                document.getElementById('votingResult').textContent = `🤐 ${mutePlayer} (الأخرس) تم استبعاده لأنه تكلم!`;
                document.getElementById('muteWarning').classList.add('hidden');
                currentGame.votingResult = mutePlayer;
                updateRefereeDisplay();
                showNotification(`${mutePlayer} تم استبعاده لأنه تكلم!`, 'warning');
            }
        }

        // بدء مؤقت النقاش
        function startDiscussionTimer() {
            if (currentGame.discussionTimerActive) {
                currentGame.discussionTimerActive = false;
            }
            
            let timeLeft = gameSettings.discussionTime;
            currentGame.discussionTimerActive = true;
            document.getElementById('startDiscussionBtn').disabled = true;
            document.getElementById('startDiscussionBtn').textContent = '⏳ المؤقت يعمل...';
            
            const timer = setInterval(() => {
                if (!currentGame.discussionTimerActive) {
                    clearInterval(timer);
                    return;
                }
                
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                document.getElementById('discussionTimer').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                // تغيير اللون عند اقتراب انتهاء الوقت
                const timerElement = document.getElementById('discussionTimer');
                if (timeLeft <= 30) {
                    timerElement.classList.add('text-red-600', 'pulse');
                } else if (timeLeft <= 60) {
                    timerElement.classList.add('text-yellow-600');
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    currentGame.discussionTimerActive = false;
                    timerElement.textContent = '⏰ انتهى الوقت!';
                    timerElement.classList.add('text-red-600', 'glow');
                    document.getElementById('startDiscussionBtn').disabled = false;
                    document.getElementById('startDiscussionBtn').textContent = '🔄 إعادة تشغيل المؤقت';
                    showNotification('انتهى وقت النقاش!', 'warning');
                }
            }, 1000);
        }

        // انتهاء النهار
        function endDay() {
            if (!currentGame.votingResult) {
                showNotification('يرجى اختيار نتيجة التصويت أولاً', 'error');
                return;
            }
            
            if (currentGame.votingResult !== 'skip') {
                const eliminatedPlayer = currentGame.votingResult;
                const playerRole = currentGame.roles[eliminatedPlayer];
                
                // التحقق من المنتحر
                if (playerRole === 'bomber') {
                    // المنتحر فاز!
                    document.getElementById('winner').innerHTML = `
                        <div class="text-4xl mb-2">💣</div>
                        <div class="text-2xl font-bold">${eliminatedPlayer} (المنتحر) فاز!</div>
                        <div class="text-lg mt-2 opacity-90">حقق هدفه بنجاح وفاز ضد الجميع</div>
                    `;
                    showFinalResults();
                    return;
                }
                
                // إقصاء اللاعب
                eliminatePlayer(eliminatedPlayer);
                
                // التحقق من القناص
                if (playerRole === 'sniper') {
                    document.getElementById('sniperAction').classList.remove('hidden');
                    createSniperTargets();
                    return;
                }
            }
            
            // التحقق من انتهاء اللعبة
            if (checkGameEnd()) {
                showFinalResults();
                return;
            }
            
            // الجولة التالية
            proceedToNextRound();
        }

        // إنشاء أهداف القناص
        function createSniperTargets() {
            const container = document.getElementById('sniperTargets');
            if (!container) return;
            
            const availableTargets = currentGame.alivePlayers.filter(p => p !== currentGame.votingResult);
            
            container.innerHTML = availableTargets.map(player => 
                `<button onclick="sniperKill('${player}')" 
                         class="stat-card rounded-lg p-2 md:p-3 transition-all text-sm md:text-base font-bold border-2 border-red-400/50 hover:border-red-400 hover:scale-105 text-red-300">
                    ${player}
                </button>`
            ).join('');
        }

        // قتل القناص
        function sniperKill(target) {
            if (!currentGame.alivePlayers.includes(target)) return;
            
            eliminatePlayer(target, 'sniper');
            document.getElementById('sniperAction').classList.add('hidden');
            showNotification(`القناص قتل ${target} قبل موته!`, 'warning');
            
            // التحقق من انتهاء اللعبة
            if (checkGameEnd()) {
                showFinalResults();
                return;
            }
            
            // متابعة اللعبة
            proceedToNextRound();
        }

        // المتابعة للجولة التالية
        function proceedToNextRound() {
            // التحقق من انتهاء اللعبة
            if (checkGameEnd()) {
                showFinalResults();
                return;
            }
            
            // الجولة التالية
            currentGame.round++;
            if (currentGame.round > gameSettings.rounds) {
                showFinalResults();
            } else {
                startNightPhase();
            }
        }

        // التحقق من انتهاء اللعبة
        function checkGameEnd() {
            const aliveMafia = currentGame.alivePlayers.filter(p => currentGame.roles[p] === 'mafia').length;
            const aliveCitizens = currentGame.alivePlayers.filter(p => {
                const role = currentGame.roles[p];
                return roles[role] && roles[role].team === 'citizen';
            }).length;
            
            return aliveMafia === 0 || aliveMafia >= aliveCitizens || currentGame.alivePlayers.length <= 1;
        }

        // إظهار النتائج النهائية
        function showFinalResults() {
            document.getElementById('refereeScreen').classList.add('hidden');
            document.getElementById('finalResultsScreen').classList.remove('hidden');
            
            // تحديد الفائز مع تفسير مفصل
            const aliveMafia = currentGame.alivePlayers.filter(p => currentGame.roles[p] === 'mafia').length;
            const aliveCitizens = currentGame.alivePlayers.filter(p => {
                const role = currentGame.roles[p];
                return roles[role] && roles[role].team === 'citizen';
            }).length;
            
            let winnerText = '';
            let winnerExplanation = '';
            let winnerEmoji = '';
            
            // التحقق من الفوز الفردي أولاً
            const survivorAlive = currentGame.alivePlayers.find(p => currentGame.roles[p] === 'survivor');
            if (survivorAlive && !document.getElementById('winner').innerHTML.includes('المنتحر')) {
                winnerEmoji = '🧑‍🎤';
                winnerText = `${survivorAlive} (الناجي) فاز!`;
                winnerExplanation = 'الناجي حقق هدفه بالبقاء حياً حتى نهاية اللعبة';
            } else if (!document.getElementById('winner').innerHTML.includes('المنتحر')) {
                if (aliveMafia === 0) {
                    winnerEmoji = '🏆';
                    winnerText = 'المدنيون انتصروا!';
                    winnerExplanation = 'تم القضاء على جميع أعضاء المافيا بنجاح';
                } else if (aliveMafia >= aliveCitizens) {
                    winnerEmoji = '🏆';
                    winnerText = 'المافيا فازت!';
                    winnerExplanation = aliveCitizens === 0 ? 
                        'تم القضاء على جميع المدنيين' : 
                        'عدد المافيا أصبح مساوياً أو أكبر من عدد المدنيين';
                } else if (currentGame.round > gameSettings.rounds) {
                    winnerEmoji = '🤝';
                    winnerText = 'انتهت الجولات - تعادل!';
                    winnerExplanation = 'انتهت جميع الجولات دون تحقيق أي فريق للفوز';
                } else {
                    winnerEmoji = '🤝';
                    winnerText = 'تعادل!';
                    winnerExplanation = 'لم يحقق أي فريق شروط الفوز';
                }
                
                document.getElementById('winner').innerHTML = `
                    <div class="text-4xl md:text-6xl mb-4">${winnerEmoji}</div>
                    <div class="text-2xl md:text-4xl font-bold mb-2">${winnerText}</div>
                    <div class="text-lg md:text-xl opacity-90">${winnerExplanation}</div>
                `;
            }
            
            // حساب الإنجازات
            calculateAchievements();
            
            // إنشاء إحصائيات اللاعبين
            createPlayerStats();
            
            // إنشاء دليل الإعلان للحكم
            createAnnouncementGuide();
            
            // إنشاء قائمة كشف الأدوار
            createRoleRevealList();
        }

        // إنشاء دليل الإعلان للحكم
        function createAnnouncementGuide() {
            const aliveMafia = currentGame.alivePlayers.filter(p => currentGame.roles[p] === 'mafia').length;
            const aliveCitizens = currentGame.alivePlayers.filter(p => {
                const role = currentGame.roles[p];
                return roles[role] && roles[role].team === 'citizen';
            }).length;
            
            let announcements = [];
            
            // إعلان النتيجة الرئيسية
            const survivorAlive = currentGame.alivePlayers.find(p => currentGame.roles[p] === 'survivor');
            const bomberWon = document.getElementById('winner').innerHTML.includes('المنتحر');
            
            if (bomberWon) {
                const bomber = players.find(p => currentGame.roles[p] === 'bomber');
                announcements.push(`💣 <strong>أعلن للجميع:</strong> "${bomber} (المنتحر) فاز بتحقيق هدفه! لعبة رائعة!"`);
            } else if (survivorAlive) {
                announcements.push(`🧑‍🎤 <strong>أعلن للجميع:</strong> "${survivorAlive} (الناجي) فاز بتحقيق هدفه!"`);
            } else if (aliveMafia === 0) {
                announcements.push(`🏆 <strong>أعلن للجميع:</strong> "المدنيون انتصروا! تم القضاء على جميع أعضاء المافيا!"`);
            } else if (aliveMafia >= aliveCitizens) {
                announcements.push(`🏆 <strong>أعلن للجميع:</strong> "المافيا فازت! ${aliveCitizens === 0 ? 'تم القضاء على جميع المدنيين' : 'أصبح عددهم مساوياً أو أكبر من المدنيين'}!"`);
            }
            
            // كشف الأدوار
            announcements.push(`🎭 <strong>اكشف جميع الأدوار:</strong> "الآن سأكشف لكم أدوار جميع اللاعبين في هذه الجولة..."`);
            
            // إحصائيات مهمة
            const survivors = currentGame.alivePlayers;
            const firstEliminated = currentGame.deadPlayers[0];
            
            if (survivors.length > 0) {
                announcements.push(`🛡️ <strong>الناجون حتى النهاية:</strong> ${survivors.join(', ')}`);
            }
            
            if (firstEliminated) {
                announcements.push(`💀 <strong>أول من خرج:</strong> ${firstEliminated}`);
            }
            
            // نصائح للحكم
            announcements.push(`<div class="bg-white/30 rounded-lg p-3 mt-4">
                <strong class="text-blue-800">📋 نصائح مهمة للحكم:</strong>
                <ul class="text-sm mt-2 space-y-1">
                    <li>• كن واضحاً وعادلاً في إعلان النتائج</li>
                    <li>• أعطِ كل لاعب لحظة لسماع دوره ونتيجته</li>
                    <li>• اسأل اللاعبين إذا يريدون إعادة اللعب</li>
                    <li>• يمكنك مشاركة هذه الإحصائيات معهم</li>
                    <li>• تأكد من أن الجميع استمتع باللعبة</li>
                </ul>
            </div>`);
            
            document.getElementById('announcementContent').innerHTML = 
                announcements.map(announcement => `<div class="bg-white/20 rounded-lg p-3 mb-2">${announcement}</div>`).join('');
        }

        // حساب الإنجازات
        function calculateAchievements() {
            const achievements = [];
            
            // الناجون
            if (currentGame.alivePlayers.length > 0) {
                achievements.push({
                    emoji: '🛡️',
                    title: 'الناجون',
                    subtitle: 'بقوا أحياء',
                    players: currentGame.alivePlayers,
                    color: 'bg-green-500/20 border-green-400'
                });
            }
            
            // أول من خرج
            if (currentGame.deadPlayers.length > 0) {
                achievements.push({
                    emoji: '💀',
                    title: 'أول ضحية',
                    subtitle: 'خرج أولاً',
                    players: [currentGame.deadPlayers[0]],
                    color: 'bg-red-500/20 border-red-400'
                });
            }
            
            // أعضاء المافيا
            const mafiaPlayers = players.filter(p => currentGame.roles[p] === 'mafia');
            if (mafiaPlayers.length > 0) {
                achievements.push({
                    emoji: '🕵️‍♂️',
                    title: 'المافيا',
                    subtitle: 'الأشرار',
                    players: mafiaPlayers,
                    color: 'bg-red-500/20 border-red-400'
                });
            }
            
            // الأدوار الخاصة
            const specialRoles = ['detective', 'doctor', 'sniper', 'oracle', 'bomber', 'survivor', 'mute', 'zombie', 'disguise'];
            specialRoles.forEach(roleKey => {
                const rolePlayers = players.filter(p => currentGame.roles[p] === roleKey);
                if (rolePlayers.length > 0) {
                    const role = roles[roleKey];
                    achievements.push({
                        emoji: role.emoji,
                        title: role.name,
                        subtitle: role.team === 'mafia' ? 'شرير' : role.team === 'citizen' ? 'بطل' : 'مستقل',
                        players: rolePlayers,
                        color: `bg-${role.team === 'mafia' ? 'red' : role.team === 'citizen' ? 'green' : 'yellow'}-500/20 border-${role.team === 'mafia' ? 'red' : role.team === 'citizen' ? 'green' : 'yellow'}-400`
                    });
                }
            });
            
            // عرض الإنجازات
            const achievementsHtml = achievements.map(achievement => 
                `<div class="stat-card rounded-lg p-3 text-center border-2 ${achievement.color}">
                    <div class="text-2xl md:text-3xl mb-2">${achievement.emoji}</div>
                    <div class="font-bold text-sm md:text-base mb-1 text-white">${achievement.title}</div>
                    <div class="text-xs text-gray-400 mb-2">${achievement.subtitle}</div>
                    <div class="text-xs font-bold text-gray-300">${achievement.players.join(', ')}</div>
                </div>`
            ).join('');
            
            document.getElementById('achievementsList').innerHTML = achievementsHtml;
        }

        // إنشاء إحصائيات اللاعبين
        function createPlayerStats() {
            // ترتيب اللاعبين: الأحياء أولاً، ثم الموتى
            const sortedPlayers = [...currentGame.alivePlayers, ...currentGame.deadPlayers];
            
            const statsHtml = sortedPlayers.map(player => {
                const stats = currentGame.playerStats[player];
                const role = roles[currentGame.roles[player]];
                const isAlive = currentGame.alivePlayers.includes(player);
                
                // تحديد إنجازات خاصة
                let specialAchievements = [];
                if (isAlive) {
                    specialAchievements.push('🛡️ نجا حتى النهاية');
                }
                if (currentGame.deadPlayers[0] === player) {
                    specialAchievements.push('💀 أول من خرج');
                }
                if (currentGame.roles[player] === 'bomber' && 
                    document.getElementById('winner').innerHTML.includes('المنتحر')) {
                    specialAchievements.push('💣 حقق هدف المنتحر');
                }
                if (currentGame.roles[player] === 'survivor' && isAlive) {
                    specialAchievements.push('🧑‍🎤 حقق هدف الناجي');
                }
                
                return `<div class="stat-card rounded-lg p-4 ${isAlive ? 'border-2 border-green-400 bg-green-500/10' : 'border border-red-400/50 bg-red-500/5'}">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-bold text-lg md:text-xl text-white">${player}</h4>
                        <div class="text-2xl md:text-3xl">${isAlive ? '🟢' : '💀'}</div>
                    </div>
                    
                    <div class="space-y-3 text-sm md:text-base">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">الدور:</span>
                            <span class="font-bold ${role.color}">${role.emoji} ${role.name}</span>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">الفريق:</span>
                            <span class="font-bold ${role.team === 'mafia' ? 'text-red-400' : 
                                role.team === 'citizen' ? 'text-green-400' : 'text-yellow-400'}">
                                ${role.team === 'mafia' ? '🔴 المافيا' : 
                                  role.team === 'citizen' ? '🟢 المدنيون' : '🟡 مستقل'}
                            </span>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">مرات الإقصاء:</span>
                            <span class="font-bold text-white">${stats.eliminated}</span>
                        </div>
                        
                        ${stats.nightKills > 0 ? `
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">قُتل ليلاً:</span>
                            <span class="font-bold text-red-400">${stats.nightKills}</span>
                        </div>` : ''}
                        
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">الحالة النهائية:</span>
                            <span class="font-bold ${isAlive ? 'text-green-400' : 'text-red-400'}">
                                ${isAlive ? '✅ حي' : '❌ ميت'}
                            </span>
                        </div>
                        
                        ${specialAchievements.length > 0 ? `
                        <div class="mt-4 pt-3 border-t border-white/20">
                            <div class="text-xs text-gray-300 mb-2 font-bold">🏅 الإنجازات:</div>
                            ${specialAchievements.map(achievement => 
                                `<div class="text-xs bg-yellow-500/20 text-yellow-300 px-2 py-1 rounded mb-1 font-bold">${achievement}</div>`
                            ).join('')}
                        </div>` : ''}
                    </div>
                </div>`;
            }).join('');
            
            document.getElementById('playerStats').innerHTML = statsHtml;
        }

        // إنشاء قائمة كشف الأدوار
        function createRoleRevealList() {
            // ترتيب اللاعبين حسب الفرق
            const mafiaPlayers = players.filter(p => currentGame.roles[p] === 'mafia');
            const citizenPlayers = players.filter(p => {
                const role = currentGame.roles[p];
                return roles[role] && roles[role].team === 'citizen';
            });
            const independentPlayers = players.filter(p => {
                const role = currentGame.roles[p];
                return roles[role] && roles[role].team === 'independent';
            });
            
            let roleRevealHtml = '';
            
            // عرض المافيا
            if (mafiaPlayers.length > 0) {
                roleRevealHtml += `<div class="bg-red-500/20 border-2 border-red-500/50 rounded-lg p-4">
                    <h4 class="font-bold text-red-400 mb-3 text-lg">🕵️‍♂️ فريق المافيا</h4>
                    ${mafiaPlayers.map(player => {
                        const role = roles[currentGame.roles[player]];
                        const isAlive = currentGame.alivePlayers.includes(player);
                        return `<div class="text-sm md:text-base mb-1 ${isAlive ? 'text-white' : 'text-gray-400'}">${role.emoji} ${player} ${isAlive ? '(حي)' : '(ميت)'}</div>`;
                    }).join('')}
                </div>`;
            }
            
            // عرض المدنيين
            if (citizenPlayers.length > 0) {
                roleRevealHtml += `<div class="bg-green-500/20 border-2 border-green-500/50 rounded-lg p-4">
                    <h4 class="font-bold text-green-400 mb-3 text-lg">🧑‍🤝‍🧑 فريق المدنيين</h4>
                    ${citizenPlayers.map(player => {
                        const role = roles[currentGame.roles[player]];
                        const isAlive = currentGame.alivePlayers.includes(player);
                        return `<div class="text-sm md:text-base mb-1 ${isAlive ? 'text-white' : 'text-gray-400'}">${role.emoji} ${player} - ${role.name} ${isAlive ? '(حي)' : '(ميت)'}</div>`;
                    }).join('')}
                </div>`;
            }
            
            // عرض الأدوار المستقلة
            if (independentPlayers.length > 0) {
                roleRevealHtml += `<div class="bg-yellow-500/20 border-2 border-yellow-500/50 rounded-lg p-4">
                    <h4 class="font-bold text-yellow-400 mb-3 text-lg">⭐ الأدوار المستقلة</h4>
                    ${independentPlayers.map(player => {
                        const role = roles[currentGame.roles[player]];
                        const isAlive = currentGame.alivePlayers.includes(player);
                        return `<div class="text-sm md:text-base mb-1 ${isAlive ? 'text-white' : 'text-gray-400'}">${role.emoji} ${player} - ${role.name} ${isAlive ? '(حي)' : '(ميت)'}</div>`;
                    }).join('')}
                </div>`;
            }
            
            document.getElementById('roleRevealList').innerHTML = roleRevealHtml;
        }

        // إعادة اللعب
        function playAgain() {
            // إعادة تعيين متغيرات اللعبة
            currentGame = {
                round: 1,
                phase: 'night',
                currentPlayerIndex: 0,
                roles: {},
                alivePlayers: [],
                deadPlayers: [],
                playerStats: {},
                nightActions: {
                    mafiaKill: null,
                    doctorSave: null,
                    detectiveCheck: null,
                    oracleCheck: null
                },
                votingResult: null,
                specialAbilities: {
                    zombieRevived: false,
                    disguiseUsed: false
                },
                discussionTimerActive: false
            };
            
            showNotification('بدء لعبة جديدة بنفس اللاعبين!', 'success');
            startGame();
        }

        // لعبة جديدة
        function newGame() {
            // إعادة تعيين كل شيء
            players = [];
            gameSettings = {
                rounds: 5,
                discussionTime: 120,
                enabledRoles: []
            };
            currentGame = {
                round: 1,
                phase: 'night',
                currentPlayerIndex: 0,
                roles: {},
                alivePlayers: [],
                deadPlayers: [],
                playerStats: {},
                nightActions: {
                    mafiaKill: null,
                    doctorSave: null,
                    detectiveCheck: null,
                    oracleCheck: null
                },
                votingResult: null,
                specialAbilities: {
                    zombieRevived: false,
                    disguiseUsed: false
                },
                discussionTimerActive: false
            };
            
            // إعادة تعيين الأدوار المختارة
            document.querySelectorAll('#rolesConfig input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
            
            // العودة لشاشة البداية
            document.getElementById('finalResultsScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
            updatePlayersList();
            updateStartButton();
            
            showNotification('مرحباً بك في لعبة جديدة!', 'success');
        }

        // إضافة مستمع للضغط على Enter
        document.getElementById('playerNameInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addPlayer();
            }
        });

        // تحديث زر البداية عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            updateStartButton();
            
            // إضافة تأثيرات بصرية للخلفية
            const body = document.body;
            body.addEventListener('mousemove', function(e) {
                const mouseX = e.clientX / window.innerWidth;
                const mouseY = e.clientY / window.innerHeight;
                
                body.style.background = `
                    radial-gradient(circle at ${mouseX * 100}% ${mouseY * 100}%, 
                    rgba(139, 69, 19, 0.1) 0%, 
                    transparent 50%), 
                    linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #533483 100%)
                `;
            });
        });

    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96a05d6666b2ce18',t:'MTc1NDMzNDczMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
